
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Baptiste DENEUVE" name="author"/>
<link href="../Session2/" rel="prev"/>
<link href="../Session4/" rel="next"/>
<link href="../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.7.1" name="generator"/>
<title>Session 3 - TP Powershell CESI</title>
<link href="../assets/stylesheets/main.484c7ddc.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#session-3">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="TP Powershell CESI" class="md-header__button md-logo" data-md-component="logo" href=".." title="TP Powershell CESI">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            TP Powershell CESI
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Session 3
            
          </span>
</div>
</div>
</div>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<a class="md-header-nav__button md-icon" href="../pdf/document.pdf" title="PDF">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
<path d="M128,0c-17.6,0-32,14.4-32,32v448c0,17.6,14.4,32,32,32h320c17.6,0,32-14.4,32-32V128L352,0H128z" fill="#E2E5E7"></path>
<path d="m384 128h96l-128-128v96c0 17.6 14.4 32 32 32z" fill="#B0B7BD"></path>
<polygon fill="#CAD1D8" points="480 224 384 128 480 128"></polygon>
<path d="M416,416c0,8.8-7.2,16-16,16H48c-8.8,0-16-7.2-16-16V256c0-8.8,7.2-16,16-16h352c8.8,0,16,7.2,16,16  V416z" fill="#F15642"></path>
<g fill="#fff">
<path d="m101.74 303.15c0-4.224 3.328-8.832 8.688-8.832h29.552c16.64 0 31.616 11.136 31.616 32.48 0 20.224-14.976 31.488-31.616 31.488h-21.36v16.896c0 5.632-3.584 8.816-8.192 8.816-4.224 0-8.688-3.184-8.688-8.816v-72.032zm16.88 7.28v31.872h21.36c8.576 0 15.36-7.568 15.36-15.504 0-8.944-6.784-16.368-15.36-16.368h-21.36z"></path>
<path d="m196.66 384c-4.224 0-8.832-2.304-8.832-7.92v-72.672c0-4.592 4.608-7.936 8.832-7.936h29.296c58.464 0 57.184 88.528 1.152 88.528h-30.448zm8.064-72.912v57.312h21.232c34.544 0 36.08-57.312 0-57.312h-21.232z"></path>
<path d="m303.87 312.11v20.336h32.624c4.608 0 9.216 4.608 9.216 9.072 0 4.224-4.608 7.68-9.216 7.68h-32.624v26.864c0 4.48-3.184 7.92-7.664 7.92-5.632 0-9.072-3.44-9.072-7.92v-72.672c0-4.592 3.456-7.936 9.072-7.936h44.912c5.632 0 8.96 3.344 8.96 7.936 0 4.096-3.328 8.704-8.96 8.704h-37.248v0.016z"></path>
</g>
<path d="m400 432h-304v16h304c8.8 0 16-7.2 16-16v-16c0 8.8-7.2 16-16 16z" fill="#CAD1D8"></path>
</svg>
</a></nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="TP Powershell CESI" class="md-nav__button md-logo" data-md-component="logo" href=".." title="TP Powershell CESI">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    TP Powershell CESI
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
<span class="md-ellipsis">
    
  
    Session 1
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Session2/">
<span class="md-ellipsis">
    
  
    Session 2
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    
  
    Session 3
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    
  
    Session 3
  

    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#gestion-active-directory-avec-powershell">
<span class="md-ellipsis">
      
        Gestion Active Directory avec Powershell
      
    </span>
</a>
<nav aria-label="Gestion Active Directory avec Powershell" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#parametrage-du-serveur">
<span class="md-ellipsis">
      
        Paramétrage du serveur
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#installation-du-service-dannuaire-active-directory">
<span class="md-ellipsis">
      
        Installation du service d’annuaire Active Directory
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#verification-de-linstallation-dactive-directory">
<span class="md-ellipsis">
      
        Vérification de l’installation d’Active Directory
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#creation-dutilisateurs-depuis-un-fichier-de-type-csv">
<span class="md-ellipsis">
      
        Création d'utilisateurs depuis un fichier de type CSV
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#creation-dutilisateurs-active-directory-depuis-une-base-de-donnees-mysql">
<span class="md-ellipsis">
      
        Création d'utilisateurs Active Directory depuis une base de données MySQL
      
    </span>
</a>
<nav aria-label="Création d'utilisateurs Active Directory depuis une base de données MySQL" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#prerequis-base-de-donnees-mariadb-mysql">
<span class="md-ellipsis">
      
        Prérequis base de données MariaDB (Mysql)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#creation-des-utilisateurs-depuis-mysql">
<span class="md-ellipsis">
      
        Création des utilisateurs depuis Mysql
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#creation-des-utilisateurs-via-csv-et-gui">
<span class="md-ellipsis">
      
        Création des utilisateurs via CSV et GUI
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Session4/">
<span class="md-ellipsis">
    
  
    Session 4
  

    
  </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#gestion-active-directory-avec-powershell">
<span class="md-ellipsis">
      
        Gestion Active Directory avec Powershell
      
    </span>
</a>
<nav aria-label="Gestion Active Directory avec Powershell" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#parametrage-du-serveur">
<span class="md-ellipsis">
      
        Paramétrage du serveur
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#installation-du-service-dannuaire-active-directory">
<span class="md-ellipsis">
      
        Installation du service d’annuaire Active Directory
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#verification-de-linstallation-dactive-directory">
<span class="md-ellipsis">
      
        Vérification de l’installation d’Active Directory
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#creation-dutilisateurs-depuis-un-fichier-de-type-csv">
<span class="md-ellipsis">
      
        Création d'utilisateurs depuis un fichier de type CSV
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#creation-dutilisateurs-active-directory-depuis-une-base-de-donnees-mysql">
<span class="md-ellipsis">
      
        Création d'utilisateurs Active Directory depuis une base de données MySQL
      
    </span>
</a>
<nav aria-label="Création d'utilisateurs Active Directory depuis une base de données MySQL" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#prerequis-base-de-donnees-mariadb-mysql">
<span class="md-ellipsis">
      
        Prérequis base de données MariaDB (Mysql)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#creation-des-utilisateurs-depuis-mysql">
<span class="md-ellipsis">
      
        Création des utilisateurs depuis Mysql
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#creation-des-utilisateurs-via-csv-et-gui">
<span class="md-ellipsis">
      
        Création des utilisateurs via CSV et GUI
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="session-3">Session 3</h1>
<h2 id="gestion-active-directory-avec-powershell">Gestion Active Directory avec Powershell</h2>
<h3 id="parametrage-du-serveur">Paramétrage du serveur</h3>
<p>Nommer la machine virtuelle à l’aide de la commande Powershell suivante :</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nb">Rename-Computer</span> <span class="n">-NewName</span> <span class="n">DC1</span> <span class="n">-force</span>
</code></pre></div>
<p>Configurer la carte réseau comme indiqué ci-dessous avec Powershell :</p>
<p>Trouver l’id de la carte réseau local à l’aide de Powershell :</p>
<p><strong>Réponse (commande utilisée et id de la carte) :</strong></p>
<p>Pour configurer l’adresse IPv4, la passerelle et le masque de sous réseau :</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="nb">Get-NetAdapter</span> <span class="n">-InterfaceIndex</span> <span class="p">&lt;</span><span class="n">id_carte_réseau</span><span class="p">&gt;</span> <span class="p">|</span> 
<a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="nb">New-NetIPAddress</span> <span class="n">-IPAddress</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">12</span> <span class="n">-DefaultGateway</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">1</span> <span class="n">-PrefixLength</span> <span class="n">24</span>
</code></pre></div>
<p>Que signifie le paramètre PrefixLength dans la commande précédente ?</p>
<p><strong>Réponse :</strong></p>
<p>Vérifier la prise en compte de la configuration :</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="nb">Get-NetAdapter</span> <span class="n">-InterfaceIndex</span> <span class="p">&lt;</span><span class="n">id_carte_réseau</span><span class="p">&gt;</span> <span class="p">|</span> <span class="nb">Get-NetIPConfiguration</span>
</code></pre></div>
<p>Tester la connexion avec le routeur :</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="nb">Test-Connection</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">12</span> <span class="n">-count</span> <span class="n">1</span>
</code></pre></div>
<p>À quelle commande historique correspond la commande ci-dessous ?</p>
<p><strong>Réponse :</strong></p>
<p>Configurer le client DNS</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="nb">Get-NetAdapter</span> <span class="n">-InterfaceIndex</span> <span class="p">&lt;</span><span class="n">id_carte_réseau</span><span class="p">&gt;</span> <span class="p">|</span> <span class="nb">Set-DnsClientServerAddress</span> <span class="n">-ServerAddresses</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">12</span>
</code></pre></div>
<h3 id="installation-du-service-dannuaire-active-directory">Installation du service d’annuaire Active Directory</h3>
<p>Créer le domaine <code>cesi&lt;id&gt;.lan</code> à l’aide de Powershell :</p>
<p>Installation des outils de management et déploiement Active Directory :</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="nb">Install-WindowsFeature</span> <span class="n">AD-Domain-Services</span><span class="p">,</span><span class="n">RSAT-ADDS-Tools</span>
</code></pre></div>
<p>Comment vérifier les rôles et fonctionnalités installés à l’aide de la console Powershell :</p>
<p><strong>Réponse :</strong></p>
<p>Redémarrer le serveur :</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="nb">Restart-Computer</span>
</code></pre></div>
<p>Pour installer Active Directory, lancer la commande Powershell suivante :</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="nb">Import-Module</span> <span class="n">ADDSDeployment</span> 
<a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="nb">Install-ADDSForest</span> <span class="n">-CreateDnsDelegation</span><span class="p">:</span><span class="nv">$false</span> <span class="n">-DatabasePath</span> <span class="s2">"C:\Windows\NTDS"</span> <span class="n">-DomainMode</span> <span class="s2">"WinThreshold"</span> <span class="p">`</span>
<a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a>   <span class="n">-DomainName</span> <span class="s2">"cesi.lan"</span> <span class="n">-DomainNetbiosName</span> <span class="s2">"CESI"</span> <span class="n">-ForestMode</span> <span class="s2">"WinThreshold"</span> <span class="n">-InstallDns</span><span class="p">:</span><span class="nv">$true</span> <span class="p">`</span>
<a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a>   <span class="n">-LogPath</span> <span class="s2">"C:\Windows\NTDS"</span> <span class="n">-NoRebootOnCompletion</span><span class="p">:</span><span class="nv">$false</span> <span class="n">-SysvolPath</span> <span class="s2">"C:\Windows\SYSVOL"</span> <span class="n">-Force</span><span class="p">:</span><span class="nv">$true</span> <span class="p">`</span>
<a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a>   <span class="n">-SafeModeAdministratorPassword</span> <span class="p">(</span><span class="nb">ConvertTo-SecureString</span> <span class="s2">"P@ssword"</span> <span class="n">-AsPlainText</span> <span class="n">-Force</span><span class="p">)</span>
</code></pre></div>
<p>Redémarrer le serveur :</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="nb">Restart-Computer</span>
</code></pre></div>
<h3 id="verification-de-linstallation-dactive-directory">Vérification de l’installation d’Active Directory</h3>
<p>Rester la configuration d’Active Directory avec la commande DCDIAG.exe</p>
<p>Tester la résolution de nom directe et inverse du nom FQDN de votre DC :</p>
<p><strong>Réponse :</strong></p>
<blockquote>
<p>En principe, il est conseillé de gérer son domaine AD depuis une console de type client. Dans cas les outils de gestion RSAT doivent être installés, dans le cas d’un DC, ils sont installés automatiquement. En dehors de cet exercice, il est vivement conseillé d’utiliser un poste de travail qui n'est pas un contrôleur de domaine pour administrer ActiveDirectory.
Depuis Powershell v3, l’import d’un module dans la session courante est automatique :
Dans ce cas la commande implicite exécutée est <strong>Import-module</strong> ActiveDirectory lors du premier lancement de la commande ActiveDirectory.</p>
</blockquote>
<ul>
<li>
<p>Créer une unité d'organistation (OU) nommée <strong>Annuaire</strong> (avec Powershell)</p>
</li>
<li>
<p>Créer un utilisateur lambda avec une adresse mail et une ville à l’aide de la commande <strong>New-Aduser</strong>, puis lui ajouter un mot de passe. (dans l’OU Annuaire crée précédemment)</p>
</li>
<li>
<p>Créer un deuxième utilisateur avec mot de passe à l’aide d’une seule ligne de commande</p>
</li>
<li>
<p>Lister tous les comptes dont le mot de passe n’a pas été changé depuis un mois. (dans le cadre de ce TP, une heure suffira étant donné la date de création des comptes)</p>
</li>
<li>
<p>À l’aide la commande précédente, forcer le changement de passe des comptes concernés</p>
</li>
</ul>
<h3 id="creation-dutilisateurs-depuis-un-fichier-de-type-csv">Création d'utilisateurs depuis un fichier de type CSV</h3>
<ul>
<li>À l’aide du fichier CSV fourni par le formateur, créez un grand nombre de comptes tel que :</li>
<li>Login : prenom.nom (limité à 20 caractères) sans accent</li>
<li>Mot de passe : nombre aléatoire de 8 caractères<ul>
<li>Bonus : utilisation d'une fonction dédiée : <a href="https://tpps.bden.fr/serve/Generate-Password.ps1">Generate-Password.ps1</a></li>
</ul>
</li>
<li>Email : <code>prenom.nom@votredomaine.xxx</code> (sans limitation de caractère)</li>
<li>Forcer le changement de mot de passe à la première ouverture de session</li>
<li>Créer l’utilisateur dans l’OU précédemment crée</li>
</ul>
<p>Fichier CSV : <a href="https://tpps.bden.fr/serve/BaseDonneesExempleCsv.csv">Lien</a></p>
<p>Fonction : <a href="https://tpps.bden.fr/serve/Remove-Diacritics.ps1">Remove-Diacritics</a></p>
<h3 id="creation-dutilisateurs-active-directory-depuis-une-base-de-donnees-mysql">Création d'utilisateurs Active Directory depuis une base de données MySQL</h3>
<h4 id="prerequis-base-de-donnees-mariadb-mysql">Prérequis base de données MariaDB (Mysql)</h4>
<ul>
<li>Installer MariaDB sur votre machine :</li>
<li><a href="https://filedn.eu/lH0OiMQas48RrgNN6AtDJA5/mariadb-10.3.7-winx64.msi">mariadb-10.3.7-winx64.msi</a></li>
<li>
<p>Choisir <strong>UTF8</strong> comme jeu de caractère</p>
</li>
<li>
<p>Dans une console CMD.exe, se connecter au serveur MariaDB :</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a>mysql -u root -p 
</code></pre></div>
<ul>
<li>Créer la base de données à l'aide de la commande suivante :</li>
</ul>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="n">RH</span><span class="p">;</span>
</code></pre></div>
<ul>
<li>Créer la table rh_users :</li>
</ul>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="n">USE</span><span class="w"> </span><span class="n">RH</span><span class="p">;</span><span class="w"> </span>
<a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">rh_users</span><span class="w"> </span><span class="p">(</span><span class="n">surname</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span><span class="w"> </span><span class="n">givenname</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span><span class="w"> </span><span class="n">city</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
</code></pre></div>
<p>Charger le fichier CSV dans la table rh_users;</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="k">LOAD</span><span class="w"> </span><span class="k">DATA</span><span class="w"> </span><span class="k">LOCAL</span><span class="w"> </span><span class="n">INFILE</span><span class="w"> </span><span class="s1">'C:/TP/CSV/BaseDonneesExempleCsv.csv'</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">rh_users</span><span class="w"> </span><span class="n">FIELDS</span><span class="w"> </span><span class="n">TERMINATED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">';'</span><span class="w"> </span><span class="n">LINES</span><span class="w"> </span><span class="n">TERMINATED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">'\n'</span><span class="w"> </span><span class="k">IGNORE</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">LINES</span><span class="w"> </span><span class="p">(</span><span class="n">surname</span><span class="p">,</span><span class="w"> </span><span class="n">givenname</span><span class="p">,</span><span class="n">city</span><span class="p">);</span><span class="w"> </span>
</code></pre></div>
<h4 id="creation-des-utilisateurs-depuis-mysql">Création des utilisateurs depuis Mysql</h4>
<ul>
<li>Supprimer tous les comptes Active Directory que vous avez créés précédemment.</li>
</ul>
<p>A l'aide des scripts fournis, créer tous les comptes présents dans la BDD MySQL dans l’AD tel que :</p>
<ul>
<li>Login (samaccountname) : prenom.nom (limité à 20 caractères) sans accent (fonction Remove-Diacritics fournie)</li>
<li>Login (UPN) : <code>prenom.nom@votredomaine.xxx</code> (sans limitation de caractère)</li>
<li>Mot de passe : nombre aléatoire de 8 caractères</li>
<li>Bonus : utilisation d'une fonction dédiée : <a href="https://tpps.bden.fr/serve/Generate-Password.ps1">Generate-Password.ps1</a></li>
<li>Email : <code>prenom.nom@votredomaine.xxx</code> (sans limitation de caractère)</li>
<li>Forcer le changement de mot de passe à la première ouverture de session</li>
<li>Créer l’utilisateur dans l’OU précédemment crée</li>
<li>Créer les dossiers personnels des utilisateurs avec attribution des droits NTFS inhérents dans le dossier partagé : <code>\\srv-data\home\&lt;username&gt;</code>, voir script <strong>SetFolderPermission.ps1</strong> pour les droits NTFS</li>
</ul>
<p>Connecteur : <a href="https://filedn.eu/lH0OiMQas48RrgNN6AtDJA5/mysql-connector-net-6.4.4.msi">.Net Mysl</a>
Fonction : <a href="https://tpps.bden.fr/serve/Get-Mysql.ps1">Get-Mysql</a> Script : <a href="https://tpps.bden.fr/serve/SetFolderPermission.ps1">SetFolderPermission</a></p>
<ul>
<li>
<p>Remplacer le serveur de fichier hébergeant les répertoires personnels par <code>\\srv-data2</code> pour tous les utilisateurs créés préalablement.</p>
</li>
<li>
<p>À l'aide de la fonction <a href="https://tpps.bden.fr/serve/Fill-PDF.ps1">Fill-PDF</a>, du fichier <a href="https://tpps.bden.fr/serve/formulaire.pdf">Formulaire.pdf</a> et de la DLL <a href="https://filedn.eu/lH0OiMQas48RrgNN6AtDJA5/itextsharp.dll">itextsharp.dll</a> générer un export pour chaque utilisateur de l'OU <strong>Annuaire</strong>.</p>
</li>
<li>
<p>Simuler la transmission par mail de chaque export PDF vers l'utilisateur concerné. (Générer la commande "send-mailmessage" sous forme d'une chaine de caractère)</p>
</li>
</ul>
<h4 id="creation-des-utilisateurs-via-csv-et-gui">Création des utilisateurs via CSV et GUI</h4>
<ul>
<li>
<p>Supprimer tous les comptes Active Directory que vous avez créés précédemment.</p>
</li>
<li>
<p>Télécharger le script suivant <a href="https://tpps.bden.fr/serve/GUI-AD.ps1">GUI-AD.ps1</a></p>
</li>
<li>
<p>Lancer le script suivant GUI-AD.ps1 - En principe une fenêtre vide doit s'afficher.</p>
</li>
<li>
<p>Décommenter la partie "Bouton de sélection  d'un fichier CSV" et relancer le script. Observez l'ajout d'un bouton concernant l'import CSV.</p>
</li>
<li>
<p>Décommenter la partie "Contenu du fichier CSV" et relancer le script. Cette fois une zone de contenu vide apparait.</p>
</li>
<li>
<p>Décommenter la partie "Bouton pour créer les utilisateurs" et relancer le script. Observez l'ajout d'un bouton concernant la création des utilisateurs.</p>
</li>
<li>
<p>Décommenter la partie "Action pour sélectionner un fichier" et relancer le script. Sélectionner le fichier CSV 'BaseDonneesExempleCsv.csv' et vérifier le résultat dans la zone de contenu.</p>
</li>
<li>
<p>Décommenter la partie "Action pour créer les utilisateurs" et relancer le script. Effectuez les opérations suivantes :</p>
</li>
<li>Adapter cette partie pour afficher le nom, le prénom et la ville dans le shell lors d'un clic sur le bouton "Créer les utilisateurs".</li>
<li>Reprendre le script de la partie CSV et l'ajouter dans la partie action. Dans un premier temps, afficher seulement la commande en mode texte dans le shell : <code>"New-Aduser -samaccountname $login -name $name ..."</code></li>
<li>
<p>Si les commandes New-Aduser semblent correctes, adapter cette partie du script pour créer les comptes.</p>
</li>
<li>
<p>Adapter le script pour créer une OU depuis l'interface graphique.</p>
</li>
<li>
<p>Adapter le script pour créer un groupe depuis l'interface graphique.</p>
</li>
<li>
<p>Adapter le script pour vérifier si les comptes existent avant création.</p>
</li>
</ul>
<aside class="md-source-file">
<span class="md-source-file__fact">
<span class="md-icon" title="Last update">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg>
</span>
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="January 13, 2026 13:47:48 UTC">January 13, 2026 13:47:48</span>
</span>
</aside>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"annotate": null, "base": "..", "features": [], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
</body>
</html>