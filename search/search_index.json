{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Session 1","text":""},{"location":"#commandes-pour-debuter","title":"Commandes pour d\u00e9buter","text":"<ul> <li> <p>Lister toutes les commandes de type \u00ab\u00a0functions\u00a0\u00bb</p> </li> <li> <p>Lister toutes les commandes se terminant par \u2018path\u2019.</p> </li> <li> <p>N'afficher que les exemples de l'aide pour la commande Get-Process</p> </li> <li> <p>Afficher de l'aide concernant For</p> </li> </ul>"},{"location":"#comprendre-un-script","title":"Comprendre un script","text":"<ul> <li>Que fait ce script\u00a0:</li> </ul> <pre><code>Get-Command | Foreach { \n    Get-Help $_ -detailed |Out-File -FilePath C:\\temp\\$_.txt \u2013Encoding ASCII\n}\n</code></pre>"},{"location":"#systeme-de-fichiers","title":"Syst\u00e8me de fichiers","text":"<ul> <li> <p>Lister tous les fichiers du r\u00e9pertoire C:\\Windows\\system32 et ses sous-r\u00e9pertoires dont la taille est sup\u00e9rieure ou \u00e9gale \u00e0 10 Mo</p> </li> <li> <p>Copier seulement les sous-r\u00e9pertoires de l\u2019arborescence (r\u00e9cursif) du r\u00e9pertoire 'program files' vers un r\u00e9pertoire de votre choix.</p> </li> </ul>"},{"location":"#gestion-systeme","title":"Gestion syst\u00e8me","text":"<ul> <li> <p>R\u00e9cup\u00e9rer tous les services arr\u00eat\u00e9s et envoyer le r\u00e9sultat dans un fichier.</p> </li> <li> <p>Lister tous les ids des mise \u00e0 jour Microsoft et envoyer le r\u00e9sultat dans un fichier.</p> </li> <li> <p>R\u00e9cup\u00e9rer les processus utilisant au moins 100 Mo.</p> </li> <li> <p>R\u00e9cup\u00e9rer dans le journal d\u2019\u00e9v\u00e9nements 'Application' , toutes les entr\u00e9es en erreur.</p> </li> </ul>"},{"location":"Session2/","title":"Session 2","text":""},{"location":"Session2/#les-fournisseurs","title":"Les fournisseurs","text":""},{"location":"Session2/#variables-denvironnement","title":"Variables d'environnement","text":"<ul> <li> <p>R\u00e9cup\u00e9rer dans une variable le contenu de la variable d'environnement computername</p> </li> <li> <p>Cr\u00e9er une variable d'environnement nomm\u00e9e login et affecter lui la valeur paul.atreides</p> </li> </ul>"},{"location":"Session2/#registre","title":"Registre","text":"<ul> <li> <p>Retrouver le chemin complet de la cl\u00e9 Winlogon dans le registre (HKEY Current User)</p> </li> <li> <p>\u00c0 l\u2019aide du chemin de registre suivant, extraire les versions et les services pack des Framework\u00a0.net install\u00e9s\u00a0 : <code>HKLM\\software\\microsoft\\Net Framework setup\\ndp</code></p> </li> <li> <p>\u00c0 l\u2019aide du chemin de registre suivant, activer le bureau \u00e0 distance de votre machine : <code>HKLM\\SYSTEM\\currentcontrolset\\control\\terminal server\\fdenytsconnections</code></p> </li> <li> <p>\u00c0 l\u2019aide du chemin de registre suivant, lister toutes les cl\u00e9s usb connect\u00e9s \u00e0 votre machine h\u00f4te : <code>HKLM\\SYSTEM\\CurrentControlSet\\Enum\\USBSTOR</code></p> </li> </ul>"},{"location":"Session2/#formatage-de-laffichage","title":"Formatage de l'affichage","text":"<ul> <li> <p>Afficher toutes les propri\u00e9t\u00e9s de la commande <code>Get-Process</code></p> </li> <li> <p>Puis choisir de n'afficher que les propri\u00e9t\u00e9s ID, Name et WorkingSet</p> </li> </ul>"},{"location":"Session2/#systeme-de-fichiers","title":"Syst\u00e8me de fichiers","text":"<ul> <li> <p>Afficher les extensions de fichiers pr\u00e9sentes dans le r\u00e9pertoire c:\\Windows de mani\u00e8re unique et dans l'ordre alphab\u00e9tique (exclure les extensions \u2018vides\u2019)</p> </li> <li> <p>Cr\u00e9er un fichier nomm\u00e9e date.log et reculer sa date de cr\u00e9ation d'un mois.</p> </li> </ul>"},{"location":"Session2/#gestion-systeme","title":"Gestion syst\u00e8me","text":"<ul> <li> <p>Afficher le nombre de services arr\u00eat\u00e9s et d\u00e9marr\u00e9s en seule ligne de commande</p> </li> <li> <p>Afficher tous les processus fabricant (Microsoft, AMD, Intel, etc..) et trier en ordre d\u00e9croissant leurs nombres.</p> </li> <li> <p>V\u00e9rifier la pr\u00e9sence d\u2019une erreur disque dans les journaux d\u2019\u00e9v\u00e8nements (id event 7)</p> </li> </ul>"},{"location":"Session2/#statistiques-manipulation-de-texte-conversion-en-objet","title":"Statistiques, manipulation de texte, conversion en objet","text":"<ul> <li> <p>Mesurer le nombre de lignes, de mots et caract\u00e8res d'un fichier texte</p> </li> <li> <p>Cr\u00e9er une variable nomm\u00e9e chaine avec la valeur Paul Atreides et effectuer les op\u00e9rations suivantes :</p> </li> <li>Convertir les majuscules en minuscule</li> <li>Remplacer l'espace par un point</li> <li>Ajouter le suffixe @cesi.fr</li> <li>Extraire le pr\u00e9nom et le nom de la chaine</li> </ul>"},{"location":"Session2/#conditions","title":"Conditions","text":"<ul> <li>Proposer \u00e0 l\u2019utilisateur de choisir un chiffre en 1 et 5 et afficher lui le chiffre choisi en toutes lettres</li> </ul>"},{"location":"Session2/#creer-une-boucle","title":"Cr\u00e9er une boucle","text":"<ul> <li>Cr\u00e9er une boucle visuelle avec la commande Write-Progress (Barre de progression)</li> </ul>"},{"location":"Session2/#services-web","title":"Services WEB","text":"<ul> <li> <p>\u00c0 l'aide de l'URL suivante, r\u00e9cup\u00e9rer l'ip publique de votre connexion Internet et stocker le r\u00e9sultat dans une variable : <code>https://api.ipify.org?format=json</code></p> </li> <li> <p>\u00c0 l'aide de l'URL suivante, r\u00e9cup\u00e9rer la liste des communes correspondant au code postal de votre choix : <code>https://geo.api.gouv.fr/communes?codePostal=&lt;code postal&gt;</code></p> </li> </ul>"},{"location":"Session3/","title":"Session 3","text":""},{"location":"Session3/#gestion-active-directory-avec-powershell","title":"Gestion Active Directory avec Powershell","text":""},{"location":"Session3/#parametrage-du-serveur","title":"Param\u00e9trage du serveur","text":"<p>Nommer la machine virtuelle \u00e0 l\u2019aide de la commande Powershell suivante\u00a0:</p> <pre><code>Rename-Computer -NewName DC1 -force\n</code></pre> <p>Configurer la carte r\u00e9seau comme indiqu\u00e9 ci-dessous avec Powershell\u00a0:</p> <p>Trouver l\u2019id de la carte r\u00e9seau local \u00e0 l\u2019aide de Powershell\u00a0:</p> <p>R\u00e9ponse\u00a0(commande utilis\u00e9e et id de la carte) :</p> <p>Pour configurer l\u2019adresse IPv4, la passerelle et le masque de sous r\u00e9seau\u00a0:</p> <pre><code>Get-NetAdapter -InterfaceIndex &lt;id_carte_r\u00e9seau&gt; | \nNew-NetIPAddress -IPAddress 192.168.10.12 -DefaultGateway 192.168.10.1 -PrefixLength 24\n</code></pre> <p>Que signifie le param\u00e8tre PrefixLength dans la commande pr\u00e9c\u00e9dente\u00a0?</p> <p>R\u00e9ponse\u00a0:</p> <p>V\u00e9rifier la prise en compte de la configuration\u00a0:</p> <pre><code>Get-NetAdapter -InterfaceIndex &lt;id_carte_r\u00e9seau&gt; | Get-NetIPConfiguration\n</code></pre> <p>Tester la connexion avec le routeur :</p> <pre><code>Test-Connection 192.168.10.12 -count 1\n</code></pre> <p>\u00c0 quelle commande historique correspond la commande ci-dessous ?</p> <p>R\u00e9ponse\u00a0:</p> <p>Configurer le client DNS</p> <pre><code>Get-NetAdapter -InterfaceIndex &lt;id_carte_r\u00e9seau&gt; | Set-DnsClientServerAddress -ServerAddresses 192.168.10.12\n</code></pre>"},{"location":"Session3/#installation-du-service-dannuaire-active-directory","title":"Installation du service d\u2019annuaire Active Directory","text":"<p>Cr\u00e9er le domaine <code>cesi&lt;id&gt;.lan</code> \u00e0 l\u2019aide de Powershell\u00a0:</p> <p>Installation des outils de management et d\u00e9ploiement Active Directory\u00a0:</p> <pre><code>Install-WindowsFeature AD-Domain-Services,RSAT-ADDS-Tools\n</code></pre> <p>Comment v\u00e9rifier les r\u00f4les et fonctionnalit\u00e9s install\u00e9s \u00e0 l\u2019aide de la console Powershell\u00a0:</p> <p>R\u00e9ponse\u00a0:</p> <p>Red\u00e9marrer le serveur\u00a0:</p> <pre><code>Restart-Computer\n</code></pre> <p>Pour installer Active Directory, lancer la commande Powershell suivante\u00a0:</p> <pre><code>Import-Module ADDSDeployment \nInstall-ADDSForest -CreateDnsDelegation:$false -DatabasePath \"C:\\Windows\\NTDS\" -DomainMode \"Win2012\" `\n   -DomainName \"cesi.lan\" -DomainNetbiosName \"CESI\" -ForestMode \"Win2012\" -InstallDns:$true `\n   -LogPath \"C:\\Windows\\NTDS\" -NoRebootOnCompletion:$false -SysvolPath \"C:\\Windows\\SYSVOL\" -Force:$true `\n   -SafeModeAdministratorPassword (ConvertTo-SecureString \"P@ssword\" -AsPlainText -Force)\n</code></pre> <p>Red\u00e9marrer le serveur\u00a0:</p> <pre><code>Restart-Computer\n</code></pre>"},{"location":"Session3/#verification-de-linstallation-dactive-directory","title":"V\u00e9rification de l\u2019installation d\u2019Active Directory","text":"<p>Rester la configuration d\u2019Active Directory avec la commande DCDIAG.exe</p> <p>Tester la r\u00e9solution de nom directe et inverse du nom FQDN de votre DC :</p> <p>R\u00e9ponse :</p> <p>En principe, il est conseill\u00e9 de g\u00e9rer son domaine AD depuis une console de type client. Dans cas les outils de gestion RSAT doivent \u00eatre install\u00e9s, dans le cas d\u2019un DC, ils sont install\u00e9s automatiquement. En dehors de cet exercice, il est vivement conseill\u00e9 d\u2019utiliser un poste de travail qui n'est pas un contr\u00f4leur de domaine pour administrer ActiveDirectory. Depuis Powershell v3, l\u2019import d\u2019un module dans la session courante est automatique\u00a0: Dans ce cas la commande implicite ex\u00e9cut\u00e9e est Import-module ActiveDirectory lors du premier lancement de la commande ActiveDirectory.</p> <ul> <li> <p>Cr\u00e9er une unit\u00e9 d'organistation (OU) nomm\u00e9e Annuaire (avec Powershell)</p> </li> <li> <p>Cr\u00e9er un utilisateur lambda avec une adresse mail et une ville \u00e0 l\u2019aide de la commande New-Aduser, puis lui ajouter un mot de passe. (dans l\u2019OU Annuaire cr\u00e9e pr\u00e9c\u00e9demment)</p> </li> <li> <p>Cr\u00e9er un deuxi\u00e8me utilisateur avec mot de passe \u00e0 l\u2019aide d\u2019une seule ligne de commande</p> </li> <li> <p>Lister tous les comptes dont le mot de passe n\u2019a pas \u00e9t\u00e9 chang\u00e9 depuis un mois. (dans le cadre de ce TP, une heure suffira \u00e9tant donn\u00e9 la date de cr\u00e9ation des comptes)</p> </li> <li> <p>\u00c0 l\u2019aide la commande pr\u00e9c\u00e9dente, forcer le changement de passe des comptes concern\u00e9s</p> </li> </ul>"},{"location":"Session3/#creation-dutilisateurs-depuis-un-fichier-de-type-csv","title":"Cr\u00e9ation d'utilisateurs depuis un fichier de type CSV","text":"<ul> <li>\u00c0 l\u2019aide du fichier CSV fourni par le formateur, cr\u00e9ez un grand nombre de comptes tel que\u00a0:</li> <li>Login\u00a0: prenom.nom (limit\u00e9 \u00e0 20 caract\u00e8res) sans accent</li> <li>Mot de passe\u00a0: nombre al\u00e9atoire de 8 caract\u00e8res<ul> <li>Bonus : utilisation d'une fonction d\u00e9di\u00e9e : Generate-Password.ps1</li> </ul> </li> <li>Email\u00a0: <code>prenom.nom@votredomaine.xxx</code> (sans limitation de caract\u00e8re)</li> <li>Forcer le changement de mot de passe \u00e0 la premi\u00e8re ouverture de session</li> <li>Cr\u00e9er l\u2019utilisateur dans l\u2019OU pr\u00e9c\u00e9demment cr\u00e9e</li> </ul> <p>Fichier CSV : Lien</p> <p>Fonction : Remove-Diacritics</p>"},{"location":"Session3/#creation-dutilisateurs-active-directory-depuis-une-base-de-donnees-mysql","title":"Cr\u00e9ation d'utilisateurs Active Directory depuis une base de donn\u00e9es MySQL","text":""},{"location":"Session3/#prerequis-base-de-donnees-mariadb-mysql","title":"Pr\u00e9requis base de donn\u00e9es MariaDB (Mysql)","text":"<ul> <li>Installer MariaDB sur votre machine :</li> <li>mariadb-10.3.7-winx64.msi</li> <li> <p>Choisir UTF8 comme jeu de caract\u00e8re</p> </li> <li> <p>Dans une console CMD.exe, se connecter au serveur MariaDB :</p> </li> </ul> <pre><code>mysql -u root -p \n</code></pre> <ul> <li>Cr\u00e9er la base de donn\u00e9es \u00e0 l'aide de la commande suivante :</li> </ul> <pre><code>CREATE DATABASE RH;\n</code></pre> <ul> <li>Cr\u00e9er la table rh_users :</li> </ul> <pre><code>USE RH; \nCREATE TABLE rh_users (surname VARCHAR(100), givenname VARCHAR(100), city VARCHAR(100));\n</code></pre> <p>Charger le fichier CSV dans la table rh_users;</p> <pre><code>LOAD DATA LOCAL INFILE 'C:/TP/CSV/BaseDonneesExempleCsv.csv' INTO TABLE rh_users FIELDS TERMINATED BY ';' LINES TERMINATED BY '\\n' IGNORE 1 LINES (surname, givenname,city); \n</code></pre>"},{"location":"Session3/#creation-des-utilisateurs-depuis-mysql","title":"Cr\u00e9ation des utilisateurs depuis Mysql","text":"<ul> <li>Supprimer tous les comptes Active Directory que vous avez cr\u00e9\u00e9s pr\u00e9c\u00e9demment.</li> </ul> <p>A l'aide des scripts fournis, cr\u00e9er tous les comptes pr\u00e9sents dans la BDD MySQL dans l\u2019AD tel que :</p> <ul> <li>Login (samaccountname)\u00a0: prenom.nom (limit\u00e9 \u00e0 20 caract\u00e8res) sans accent (fonction Remove-Diacritics fournie)</li> <li>Login (UPN) : <code>prenom.nom@votredomaine.xxx</code> (sans limitation de caract\u00e8re)</li> <li>Mot de passe\u00a0: nombre al\u00e9atoire de 8 caract\u00e8res</li> <li>Bonus : utilisation d'une fonction d\u00e9di\u00e9e : Generate-Password.ps1</li> <li>Email\u00a0: <code>prenom.nom@votredomaine.xxx</code> (sans limitation de caract\u00e8re)</li> <li>Forcer le changement de mot de passe \u00e0 la premi\u00e8re ouverture de session</li> <li>Cr\u00e9er l\u2019utilisateur dans l\u2019OU pr\u00e9c\u00e9demment cr\u00e9e</li> <li>Cr\u00e9er les dossiers personnels des utilisateurs avec attribution des droits NTFS inh\u00e9rents dans le dossier partag\u00e9 : <code>\\\\srv-data\\home\\&lt;username&gt;</code>, voir script SetFolderPermission.ps1 pour les droits NTFS</li> </ul> <p>Connecteur : .Net Mysl Fonction : Get-Mysql Script : SetFolderPermission</p> <ul> <li> <p>Remplacer le serveur de fichier h\u00e9bergeant les r\u00e9pertoires personnels par <code>\\\\srv-data2</code> pour tous les utilisateurs cr\u00e9\u00e9s pr\u00e9alablement.</p> </li> <li> <p>\u00c0 l'aide de la fonction Fill-PDF, du fichier Formulaire.pdf et de la DLL itextsharp.dll g\u00e9n\u00e9rer un export pour chaque utilisateur de l'OU Annuaire.</p> </li> <li> <p>Simuler la transmission par mail de chaque export PDF vers l'utilisateur concern\u00e9. (G\u00e9n\u00e9rer la commande \"send-mailmessage\" sous forme d'une chaine de caract\u00e8re)</p> </li> </ul>"},{"location":"Session3/#creation-des-utilisateurs-via-csv-et-gui","title":"Cr\u00e9ation des utilisateurs via CSV et GUI","text":"<ul> <li> <p>Supprimer tous les comptes Active Directory que vous avez cr\u00e9\u00e9s pr\u00e9c\u00e9demment.</p> </li> <li> <p>T\u00e9l\u00e9charger le script suivant GUI-AD.ps1</p> </li> <li> <p>Lancer le script suivant GUI-AD.ps1 - En principe une fen\u00eatre vide doit s'afficher.</p> </li> <li> <p>D\u00e9commenter la partie \"Bouton de s\u00e9lection  d'un fichier CSV\" et relancer le script. Observez l'ajout d'un bouton concernant l'import CSV.</p> </li> <li> <p>D\u00e9commenter la partie \"Contenu du fichier CSV\" et relancer le script. Cette fois une zone de contenu vide apparait.</p> </li> <li> <p>D\u00e9commenter la partie \"Bouton pour cr\u00e9er les utilisateurs\" et relancer le script. Observez l'ajout d'un bouton concernant la cr\u00e9ation des utilisateurs.</p> </li> <li> <p>D\u00e9commenter la partie \"Action pour s\u00e9lectionner un fichier\" et relancer le script. S\u00e9lectionner le fichier CSV 'BaseDonneesExempleCsv.csv' et v\u00e9rifier le r\u00e9sultat dans la zone de contenu.</p> </li> <li> <p>D\u00e9commenter la partie \"Action pour cr\u00e9er les utilisateurs\" et relancer le script. Effectuez les op\u00e9ration suivantes :</p> </li> <li>Adapteur cette partie pour affichier le nom, le pr\u00e9nom et la ville dans le shell lors d'un clic que le bouton \"Cr\u00e9er les utilisateurs\"</li> <li>Reprendre le script de la partie CSV et l'ajouter dans la partie action. Dans un premier temps afficher seulement la commande en mode texte dans le shell : <code>\"New-Aduser -samaccountname $login -name $name ...\"</code></li> <li> <p>Si les commandes New-Aduser semblent correctes, adapter cette partie du script pour cr\u00e9er les comptes.</p> </li> <li> <p>Adapter le script pour cr\u00e9er une OU depuis l'interface graphique.</p> </li> <li> <p>Adapter le script pour cr\u00e9er un groupe depuis l'interface graphique.</p> </li> <li> <p>Adapter le script pour v\u00e9rifier si les comptes existent avant cr\u00e9ation. </p> </li> </ul>"},{"location":"Session4/","title":"Session 4","text":""},{"location":"Session4/#utilisation-de-wmicim","title":"Utilisation de WMI/CIM","text":""},{"location":"Session4/#prerequis","title":"Pr\u00e9requis","text":"<ul> <li>2 machines Windows virtuelles nomm\u00e9es Client1, Client2 jointes au domaine CESI.LAN</li> </ul>"},{"location":"Session4/#wmicim-windows-management-instrumentation","title":"WMI/CIM (Windows Management Instrumentation)","text":"<ul> <li>Depuis le DC, lancer une console powershell, puis les commandes suivantes\u00a0:</li> </ul> <pre><code>$CimSession = New-CimSession -ComputerName Client1 -Credential (Get-Credential)\nGet-CimInstance -CimSession $CimSession -ClassName Win32_Bios\n</code></pre> <ul> <li> <p>Adapter la commande pr\u00e9c\u00e9dente, pour interroger toutes les deux VMs (Client1 et 2)</p> </li> <li> <p>Adapter votre script pour d\u00e9tecter le syst\u00e8me d\u2019exploitation</p> </li> <li> <p>Adapter le script pour afficher, le nom de la machine, le nom du syst\u00e8me d\u2019exploitation, sa version et son architecture (x64 ou x86).</p> </li> <li> <p>\u00c0 l\u2019aide de la classe WMI win32_LogicalDisk, afficher la taille et l\u2019espace libre des partitions.</p> </li> <li> <p>Affiner la sortie de la commande pr\u00e9c\u00e9dente pour afficher en tableau les colonnes suivantes\u00a0: Name, Espace Libre (en GB) et taille (en GB). Garder ce script pour la prochaine partie.</p> </li> </ul> <p><code>Conseil\u00a0: utiliser la syntaxe :</code> <code>@{label = &lt;string&gt;\u00a0; expression = {&lt;script&gt;}}</code></p>"},{"location":"Session4/#envoi-de-message-et-html","title":"Envoi de message\u00a0et HTML","text":"<ul> <li> <p>\u00c0 l\u2019aide de la commande Send-Mailmessage, envoyez-vous un mail de test\u00a0(adaptez les param\u00e8tres de la commande en fonction de votre fournisseur de messagerie\u00a0: SSL\u00a0?, Port 25 ou 587\u2026)</p> </li> <li> <p>\u00c0 l\u2019aide du script de la derni\u00e8re partie (concernant Win32_LogicalDisk), envoyer la liste des partitions de vos 3 VMs \u00e0 votre adresse mail.</p> </li> <li> <p>R\u00e9p\u00e9tez l\u2019op\u00e9ration pr\u00e9c\u00e9dente en convertissant le retour du script en HTML.</p> </li> </ul>"}]}